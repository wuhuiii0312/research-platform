# 科研项目协作平台 - 全项目修复验证方案

## 一、各服务最终端口分配表（无冲突）

| 服务 | 端口 | 说明 |
|------|------|------|
| research-auth | 8081 | 认证服务，端口固化于 application-dev.yml |
| research-project | 8082 | 项目服务 |
| research-task | 8083 | 任务服务 |
| research-document | 8084 | 文档服务 |
| research-gateway | 8085 | 网关，前端 /api 代理目标 |
| research-user | 8086 | 用户服务 |
| research-search | 8087 | 搜索服务 |
| research-notification | 8088 | 通知服务 |
| Nacos | 8080 | 中间件（可选） |
| MySQL | 3306 | 中间件 |
| Redis | 6379 | 中间件 |

服务端口与中间件 8080/3306/6379 无冲突。

---

## 二、各服务 pom.xml 中 spring-boot-maven-plugin 配置

所有服务均包含以下 JVM 参数（无需手动传参）：`-Xms256m -Xmx512m`。

### research-auth

```xml
<plugin>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-maven-plugin</artifactId>
    <version>2.7.18</version>
    <configuration>
        <mainClass>com.research.auth.ResearchAuthApplication</mainClass>
        <jvmArguments>-Xms256m -Xmx512m</jvmArguments>
    </configuration>
</plugin>
```

### research-gateway

```xml
<plugin>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-maven-plugin</artifactId>
    <version>${spring-boot.version}</version>
    <configuration>
        <jvmArguments>-Xms256m -Xmx512m</jvmArguments>
    </configuration>
    <executions>...</executions>
</plugin>
```

### research-project / research-task / research-document / research-user / research-search / research-notification

```xml
<plugin>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-maven-plugin</artifactId>
    <configuration>
        <mainClass>com.research.xxx.XxxApplication</mainClass>
        <jvmArguments>-Xms256m -Xmx512m</jvmArguments>
    </configuration>
</plugin>
```

父工程 research-parent 的 pluginManagement 中已配置默认 `jvmArguments>-Xms256m -Xmx512m</jvmArguments>`，子模块可继承。

---

## 三、各服务 application-dev.yml 或 application.yml 端口配置

- **research-auth**：`application.yml` 不写 `server.port`，由 `application-dev.yml` 固化端口；`application-dev.yml` 内容：
  ```yaml
  server:
    port: 8081
  ```
- **research-project / research-task / research-document / research-user / research-search / research-notification**：端口在各自 `application.yml` 的 `server.port` 中固化（8082/8083/8084/8086/8087/8088）。
- **research-gateway**：端口在 `application.yml` 与 `bootstrap.yml` 中为 8085；默认 `spring.profiles.active: standalone`，使用静态路由，无需 Nacos。

---

## 四、兼容 PowerShell 的统一启动命令（每服务一条，直接复制执行）

在 **PowerShell** 中，每个服务仅需一条命令，无额外 JVM 或 profile 参数：

```powershell
# 认证服务
cd d:\projectapp\research-platform\research-auth
mvn spring-boot:run -DskipTests

# 网关
cd d:\projectapp\research-platform\research-gateway
mvn spring-boot:run -DskipTests

# 项目服务
cd d:\projectapp\research-platform\research-project
mvn spring-boot:run -DskipTests

# 任务服务
cd d:\projectapp\research-platform\research-task
mvn spring-boot:run -DskipTests

# 文档服务
cd d:\projectapp\research-platform\research-document
mvn spring-boot:run -DskipTests

# 用户服务
cd d:\projectapp\research-platform\research-user
mvn spring-boot:run -DskipTests

# 搜索服务
cd d:\projectapp\research-platform\research-search
mvn spring-boot:run -DskipTests

# 通知服务
cd d:\projectapp\research-platform\research-notification
mvn spring-boot:run -DskipTests
```

无需使用引号包裹参数，不会出现「未知生命周期阶段」等错误。

---

## 五、全项目启动验证步骤

1. **中间件**
   - 启动 MySQL（3306）、Redis（6379）；可选 Nacos（8080 或 8848，网关当前默认 standalone 可不启）。

2. **编译**
   ```powershell
   cd d:\projectapp\research-platform\research-parent
   mvn clean install -DskipTests
   ```

3. **后端核心四服务（脚本或手动）**
   - 方式 A：`cd d:\projectapp\research-platform` 后执行 `.\scripts\start-backend.ps1`，依次启动 auth(8081)、gateway(8085)、project(8082)、task(8083)。
   - 方式 B：开 4 个终端，分别进入 research-auth、research-gateway、research-project、research-task，各执行 `mvn spring-boot:run -DskipTests`。

4. **验证**
   - 网关：浏览器访问 http://localhost:8085 应有响应。
   - 认证：`POST http://localhost:8081/auth/login`，Body `{"username":"admin","password":"123456"}` 应返回 token。
   - 前端：`cd research-frontend` → `npm install` → `npm run serve`，访问 http://localhost:8080，登录页应可调通网关并登录。

5. **自检清单**
   - 无「Port is already in use」：各服务端口唯一且未与中间件冲突。
   - 无「内存不足」「页面文件太小」：pom 中已统一 `-Xms256m -Xmx512m`。
   - 无「Unknown lifecycle phase」：PowerShell 中仅使用 `mvn spring-boot:run -DskipTests`，无含空格的未加引号参数。

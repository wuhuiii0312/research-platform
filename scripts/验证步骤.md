# 科研项目协作平台 - 修改后验证步骤

## 〇、替换文件与清理缓存（修改后必做）

1. **替换所有修改后的文件**（见下方「修改后完整代码」）。
2. **清理 Maven 编译缓存与本地仓库缓存**，避免「duplicated in the reactor」或旧依赖残留：

```bash
cd D:\projectapp\research-platform
mvn clean
rd /s /q research-parent\target 2>nul
rd /s /q research-common\target 2>nul
rd /s /q research-gateway\target 2>nul
rd /s /q research-auth\target 2>nul
rd /s /q research-user\target 2>nul
rd /s /q research-project\target 2>nul
rd /s /q research-task\target 2>nul
rd /s /q research-document\target 2>nul
rd /s /q research-search\target 2>nul
```

（可选）清理本地仓库中本工程 artifact，避免版本冲突后再重新构建：

```bash
rd /s /q %USERPROFILE%\.m2\repository\com\research 2>nul
```

3. **Maven settings.xml 中 \<mirror\> 语法警告**：若执行 Maven 时出现「Unrecognised tag: 'mirror'」或 PITarget 保留字错误，请打开 `C:\apache-maven-3.9.12\conf\settings.xml`，确保 `<mirrors>` 为 `<settings>` 的直接子节点，且 `<mirror>` 仅出现在 `<mirrors>` 内、**不要**写在 `<profiles>` 或 `<repository>` 内部。可参考项目内 `scripts/settings-mirrors-正确配置.xml` 中的 `<mirrors>...</mirrors>` 整段复制替换。

## 一、编译所有模块

在项目根目录执行（**必须从根目录执行**）：

```bash
cd D:\projectapp\research-platform
mvn clean install -DskipTests
```

- 根 pom 仅聚合 `<module>research-parent</module>`，由 research-parent 的 `<modules>` 定义子模块，**避免 reactor 中 research-common 等重复**。
- 构建顺序：先构建 `research-parent`（POM），再按 research-parent 的 modules 顺序构建 research-common、research-gateway、research-auth、research-user、research-project、research-task、research-document、research-search、research-notification。
- MySQL 依赖由 research-parent 统一管理为 `com.mysql:mysql-connector-j`（适配 Java 17+），根 pom 不声明 MySQL。

## 二、中间件启动

1. **Nacos**（端口 8080，与配置一致）
   - 若 Nacos 默认端口为 8848，需在 Nacos 安装目录 `conf/application.properties` 中设置 `server.port=8080`，或将所有服务配置中的 `server-addr` 改为 `localhost:8848`。
2. **MySQL**：库名 **research_platform**（与 sql/schema.sql 一致），账号 root / 密码 123456；执行 `sql/schema.sql` 建表。
3. **Redis**：端口 6379（auth 服务、网关可选使用）。

## 三、服务启动顺序

1. 启动 **research-auth**（端口 8081）：认证/登录、/api/user 与 /api/auth。
2. 启动 **research-project**（端口 8082）。
3. 启动 **research-task**（端口 8083）。
4. 启动 **research-document**（端口 8084）。
5. 启动 **research-gateway**（端口 8085）：网关，需在 Nacos、各业务服务之后启动。
6. 启动 **research-user**（端口 8086，与 auth 区分避免端口冲突）。
7. 启动 **research-search**（端口 8087，可选）。

每个服务：`cd 对应模块目录` 后执行 `mvn spring-boot:run`，或用 IDE 运行对应 `*Application` 主类。

## 四、Nacos 注册验证

- 打开 Nacos 控制台：`http://localhost:8080/nacos`（若 Nacos 为 8848 则用 8848）。
- 在「服务管理」→「服务列表」中应看到：research-auth、research-user、research-project、research-task、research-document、research-gateway、research-search（若已启动）。

## 五、前端访问验证

1. 前端根目录：`D:\projectapp\research-platform\research-frontend`。
2. 安装依赖：`npm install`；启动：`npm run serve`（或 `npm run dev`，视 package.json 而定）。
3. 浏览器访问：`http://localhost:8080`（或控制台打印的前端端口）。
4. 登录：调用 `http://localhost:8085/api/auth/login` 或 `/api/user/login`（经网关 8085 转发到 auth 8081）。
5. 确认 `research-frontend/src/api/request.js` 中 `baseURL` 为 `http://localhost:8085/api`。
6. JWT 过期时间为 2 小时（jwt.expire=7200 秒），Token 生成后可正常验证至过期。

## 六、端口与配置一览

| 服务               | 端口 | Nacos 地址   | 数据库           |
|--------------------|------|-------------|------------------|
| research-auth      | 8081 | localhost:8080 | research_platform |
| research-project   | 8082 | localhost:8080 | research_platform |
| research-task      | 8083 | localhost:8080 | research_platform |
| research-document  | 8084 | localhost:8080 | research_platform |
| research-gateway   | 8085 | localhost:8080 | -                |
| research-user      | 8086 | localhost:8080 | research_platform |
| research-search    | 8087 | localhost:8080 | -                |

- JWT：`jwt.secret=project-secret-key-1234567890`，`jwt.expire=7200`（**秒**，2 小时；research-common JwtUtil 与 research-auth JwtUtils 均按秒×1000 转毫秒计算过期时间）。

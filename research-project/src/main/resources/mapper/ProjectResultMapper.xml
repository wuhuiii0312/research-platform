<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.research.project.mapper.ProjectResultMapper">
    <select id="statisticResult" resultType="map">
        SELECT
            COUNT(*) AS total,
            SUM(CASE WHEN type='PAPER' THEN 1 ELSE 0 END) AS paperCount,
            SUM(CASE WHEN type='PATENT' THEN 1 ELSE 0 END) AS patentCount,
            SUM(CASE WHEN type='SOFT' THEN 1 ELSE 0 END) AS softCount,
            SUM(CASE WHEN type='REPORT' THEN 1 ELSE 0 END) AS reportCount
        FROM project_result
        WHERE del_flag = 0 AND (test_data_flag = 0 OR test_data_flag IS NULL)
        <if test="projectId != null">
            AND project_id = #{projectId}
        </if>
    </select>
</mapper>
